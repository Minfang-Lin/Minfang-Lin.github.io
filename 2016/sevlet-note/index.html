<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Servlet学习笔记（一） · 叶卡林娜的部落格</title><meta name="description" content="Servlet学习笔记（一） - Minfang Lin"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://leavesite.com/atom.xml" title="叶卡林娜的部落格"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/Minfang-Lin" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Servlet学习笔记（一）</h1><div class="post-info">Sep 27, 2016</div><div class="post-content"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Servlet == Server + Applet</p>
<p>运行在服务端的Java程序，Servlet不同于普通的Java类，它没有main方法，它不能独立运行在JVM上，它需要在特殊的容器中装载运行，由容器管理其生成和销毁。Servlet几乎能处理所有的Http请求，并能够给客户端提供相应的Http响应。故可以将Servlet的功能总结如下：</p>
<blockquote>
<p>一个Servlet就是一个Java类，并提供基于请求-响应模式的Web服务。</p>
</blockquote>
<h2 id="Servlet与Servlet容器"><a href="#Servlet与Servlet容器" class="headerlink" title="Servlet与Servlet容器"></a>Servlet与Servlet容器</h2><p>Servlet容器装载和管理Servlet（包括Servlet创建、执行、销毁等等），它是一个服务端程序，这个程序负责把请求转发给Servlet，交由Servlet处理，Servlet处理完毕后，将结果返回给客户端。</p>
<a id="more"></a>
<h2 id="Servlet处理流程"><a href="#Servlet处理流程" class="headerlink" title="Servlet处理流程"></a>Servlet处理流程</h2><p>在浏览器中输入一个URL，Servlet容器根据URL地址，通过配置文件（web.xml）找到对应的Servlet，同时将请求转发给Servlet的service方法。如果通过Get方法发送请求，service方法就将请求转发给doGet方法。</p>
<h2 id="Servlet生命周期"><a href="#Servlet生命周期" class="headerlink" title="Servlet生命周期"></a>Servlet生命周期</h2><ol>
<li>初始化：Servlet初始化对应init方法，默认的情况下，只有当web客户端第一次请求某Servlet的时候，Servlet容器才会创建这个Servlet对象的实例，这时Servlet容器会回调Servlet的init方法。如果在Servlet配置文件中配置了load-on-startup元素，那Servlet也可能是在容器启动时被相应加载。</li>
<li>请求处理：对应service方法，Servlet会根据请求类型将不同的请求交由不同的Servlet处理。最常用的是doGet和doPost方法。</li>
<li>销毁阶段：对应destroy方法，是Servlet在销毁前由Servlet容器回调。会做一些资源的回收和清理工作。</li>
</ol>
<p>测试代码：<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//HelloWorld.java</span></div><div class="line"><span class="keyword">package</span> com.netease.hello;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.ServletException;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest requst, HttpServletResponse response)</span> </span></div><div class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">    System.out.println(<span class="string">"doGet method"</span>);</div><div class="line">    PrintWriter pw = response.getWriter();</div><div class="line">    pw.print(<span class="string">"hello world"</span>);</div><div class="line">    pw.close();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span></div><div class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">    System.out.println(<span class="string">"service method"</span>);</div><div class="line">    <span class="keyword">super</span>.service(request, response);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</div><div class="line">    System.out.println(<span class="string">"destory method"</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">    System.out.println(<span class="string">"init method"</span>);	</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="comment">&lt;!-- web.xml --&gt;</span></div><div class="line"><span class="meta">&lt;!DOCTYPE web-app PUBLIC</span></div><div class="line"><span class="meta"> "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span></div><div class="line"><span class="meta"> "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloWorld<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.netease.hello.HelloWorld<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloWorld<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Get与Post"><a href="#Get与Post" class="headerlink" title="Get与Post"></a>Get与Post</h2><table>
<thead>
<tr>
<th style="text-align:center">.</th>
<th style="text-align:center">Get</th>
<th style="text-align:center">Post</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">传输方式</td>
<td style="text-align:center">HTTP header，URL可见</td>
<td style="text-align:center">HTTP body，URL不可见</td>
</tr>
<tr>
<td style="text-align:center">传输长度</td>
<td style="text-align:center">受限于URL长度，一般在2k~8k</td>
<td style="text-align:center">一般没有限制</td>
</tr>
<tr>
<td style="text-align:center">设计目的</td>
<td style="text-align:center">获取数据</td>
<td style="text-align:center">发送数据</td>
</tr>
<tr>
<td style="text-align:center">安全性</td>
<td style="text-align:center">低</td>
<td style="text-align:center">高</td>
</tr>
</tbody>
</table>
<p>测试代码：<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//GetPostTest.java</span></div><div class="line"><span class="keyword">package</span> com.netease.hello;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.ServletException;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetPostTest</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span></div><div class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">    request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</div><div class="line">    response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</div><div class="line">    PrintWriter out = response.getWriter();</div><div class="line">    String name1 = request.getParameter(<span class="string">"name1"</span>);</div><div class="line">    String pwd1 = request.getParameter(<span class="string">"pwd1"</span>);</div><div class="line">    out.println(<span class="string">"调用doGet方法"</span>);</div><div class="line">    out.println(<span class="string">"用户名: "</span> + name1);</div><div class="line">    out.print(<span class="string">"密码： "</span> + pwd1);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span></div><div class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">    request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</div><div class="line">    response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</div><div class="line">    PrintWriter out = response.getWriter();</div><div class="line">    String name2 = request.getParameter(<span class="string">"name2"</span>);</div><div class="line">    String pwd2 = request.getParameter(<span class="string">"pwd2"</span>);</div><div class="line">    out.println(<span class="string">"调用doPost方法"</span>);</div><div class="line">    out.println(<span class="string">"用户名: "</span> + name2);</div><div class="line">    out.print(<span class="string">"密码： "</span> + pwd2);		</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="comment">&lt;!-- index.jsp --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></div><div class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Get/Post方法提交<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"./GetPostServlet"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></div><div class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name1"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">    密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd1"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"使用Get提交"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"./GetPostServlet"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></div><div class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name2"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">    密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd2"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"使用Post提交"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="comment">&lt;!-- web.xml中配置部分 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>GetPostTest<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.netease.hello.GetPostTest<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>GetPostTest<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/GetPostServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="解决doGet方法中文乱码的问题："><a href="#解决doGet方法中文乱码的问题：" class="headerlink" title="解决doGet方法中文乱码的问题："></a>解决doGet方法中文乱码的问题：</h4><p>将tomcat安装目录下的conf/server.xml文件中<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">port</span>=<span class="string">"8080"</span> </span></div><div class="line"><span class="tag">  <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>改成<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">port</span>=<span class="string">"8080"</span> </span></div><div class="line"><span class="tag">  <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> <span class="attr">URIEncoding</span>=<span class="string">"utf-8"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="Servlet配置参数"><a href="#Servlet配置参数" class="headerlink" title="Servlet配置参数"></a>Servlet配置参数</h2><h4 id="ServletConfig对象"><a href="#ServletConfig对象" class="headerlink" title="ServletConfig对象"></a>ServletConfig对象</h4><p>测试代码：<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="comment">&lt;!-- ServletConfig Test --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ServletConfigTest<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.netease.hello.ServletConfigTest<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>data1<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>value1<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>data2<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>value2<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ServletConfigTest<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/ServletConfigTest<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// ServletConfigTest.java</span></div><div class="line"><span class="keyword">package</span> com.netease.hello;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</div><div class="line"><span class="keyword">import</span> javax.servlet.ServletException;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletConfigTest</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">    ServletConfig config = <span class="keyword">this</span>.getServletConfig();</div><div class="line">    String v1 = config.getInitParameter(<span class="string">"data1"</span>);</div><div class="line">    System.out.println(<span class="string">"v1: "</span> + v1);</div><div class="line">    String v2 = config.getInitParameter(<span class="string">"data2"</span>);</div><div class="line">    System.out.println(<span class="string">"v2: "</span> + v2);</div><div class="line"></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span></div><div class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">    PrintWriter pw = resp.getWriter();</div><div class="line">    pw.print(<span class="string">"ServletConfig test"</span>);</div><div class="line">    pw.close();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Servlet初始化过程中，<code>&lt;init-param&gt;</code>参数将被封装到ServletConfig对象中，每个Servlet支持一个或者多个<code>&lt;init-param&gt;</code>，这个配置是以Servlet为单位，不是全局共享的。</p>
<h4 id="ServletContext对象"><a href="#ServletContext对象" class="headerlink" title="ServletContext对象"></a>ServletContext对象</h4><p>Servlet容器在启动时会为每一个web应用创建一个ServletContext对象，这个ServletContext对象代表了当前的web应用。ServletContext对象在web应用中是全局唯一的，所以在Servlet容器中的任何Servlet访问的是同一个ServletContext对象。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">ServletContext ctx = <span class="keyword">this</span>.getServletContext();</div><div class="line">String gv1 = ctx.getInitParameter(<span class="string">"globalData1"</span>);</div><div class="line">System.out.println(<span class="string">"gv1: "</span> + gv1);</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="comment">&lt;!-- ServletContext Test --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>globalData1<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>globalValue1<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>globalData2<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>globalValue2<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></div></pre></td></tr></table></figure>
<p>如果不同Servlet之间的共享信息不是事先知道的，通过setAttribute、getAttribute、removeAttribute进行配置信息的增删改查。每一对属性是key-value的键值对。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">ServletContext ctx = <span class="keyword">this</span>.getServletContext();</div><div class="line">ctx.setAttribute(<span class="string">"attrbute1"</span>, <span class="string">"111"</span>);</div><div class="line">ctx.getAttribute(<span class="string">"attribute1"</span>);</div><div class="line">ctx.removeAttribute(<span class="string">"attribute1"</span>);</div></pre></td></tr></table></figure></p>
<h2 id="读取外部资源配置信息"><a href="#读取外部资源配置信息" class="headerlink" title="读取外部资源配置信息"></a>读取外部资源配置信息</h2><h4 id="getResource"><a href="#getResource" class="headerlink" title="getResource"></a>getResource</h4><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">ServletContext ctx = <span class="keyword">this</span>.getServletContext();	</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">  <span class="comment">// 此处路径是相对于web应用的</span></div><div class="line">  URL url = ctx.getResource(<span class="string">"/WEB-INF/classes/log4j.properties"</span>);</div><div class="line">  InputStream in = url.openStream();</div><div class="line">  String propertyValue = GeneralUtil.getPropery(<span class="string">"log4j.rootLogger"</span>,</div><div class="line">      in);</div><div class="line">  System.out.println(<span class="string">"property value: "</span> + propertyValue);</div><div class="line">&#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</div><div class="line">  e.printStackTrace();</div><div class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">  e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneralUtil</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateId</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> UUID.randomUUID().toString().replaceAll(<span class="string">"-"</span>, <span class="string">""</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPropery</span><span class="params">(String key, InputStream in)</span> </span>&#123;</div><div class="line">    Properties props = <span class="keyword">new</span> Properties();</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      props.load(in);</div><div class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">      e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    String value = props.getProperty(key);</div><div class="line">    <span class="keyword">return</span> value;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="getResourceAsStream"><a href="#getResourceAsStream" class="headerlink" title="getResourceAsStream"></a>getResourceAsStream</h4><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">InputStream in2 = ctx</div><div class="line">    .getResourceAsStream(<span class="string">"/WEB-INF/classes/log4j.properties"</span>);</div><div class="line">String p2 = GeneralUtil.getPropery(<span class="string">"log4j.rootLogger"</span>, in2);</div><div class="line">System.out.println(<span class="string">"p2: "</span> + p2);</div></pre></td></tr></table></figure>
<h4 id="getRealPath"><a href="#getRealPath" class="headerlink" title="getRealPath"></a>getRealPath</h4><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">String path = ctx.getRealPath(<span class="string">"/WEB-INF/classes/log4j.properties"</span>);</div><div class="line">System.out.println(<span class="string">"real path: "</span> + path);</div><div class="line">File f = <span class="keyword">new</span> File(path);</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">  InputStream in3 = <span class="keyword">new</span> FileInputStream(f);</div><div class="line">  String p3 = GeneralUtil.getPropery(<span class="string">"log4j.rootLogger"</span>, in3);</div><div class="line">  System.out.println(<span class="string">"p3: "</span> + p3);</div><div class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">  e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Web应用程序结构"><a href="#Web应用程序结构" class="headerlink" title="Web应用程序结构"></a>Web应用程序结构</h2><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">webapp</div><div class="line">   |--css</div><div class="line">   |--js</div><div class="line">   |--images</div><div class="line">   |--html</div><div class="line">   |--META-INF</div><div class="line">   |--WEB-INF</div><div class="line">        |--classes</div><div class="line">        |--lib</div><div class="line">        web.xml</div></pre></td></tr></table></figure>
<h2 id="部署描述符"><a href="#部署描述符" class="headerlink" title="部署描述符"></a>部署描述符</h2><p>web.xml是用于配置部署描述符的文件，用来设置web应用程序的组件部署信息。Servlet容器需要支持部署描述符中的所有元素。</p>
<h4 id="Servlet-URL匹配"><a href="#Servlet-URL匹配" class="headerlink" title="Servlet URL匹配"></a>Servlet URL匹配</h4><p>Servlet支持多个url-pattern对应同一个Servlet，url-pattern支持模糊匹配。</p>
<p>ServletMapping匹配原则</p>
<ol>
<li>精确路径匹配，完全匹配</li>
<li>最长路径匹配，最长前缀匹配</li>
<li>扩展名匹配</li>
<li>default servlet或者放弃</li>
</ol>
<h4 id="load-on-startup"><a href="#load-on-startup" class="headerlink" title="load-on-startup"></a>load-on-startup</h4><p>用于改变Servlet默认初始化时间，当大于或等于0，表示Servlet启动时会加载这个Servlet。如果不设置或设置负数的时候，只有当第一次请求这个Servlet时，才会被加载。正数值越小，越优先启动。</p>
<h4 id="配置自定义错误页面"><a href="#配置自定义错误页面" class="headerlink" title="配置自定义错误页面"></a>配置自定义错误页面</h4><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">location</span>&gt;</span>/404.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></div></pre></td></tr></table></figure>
<p>更高级的做法还可以添加excepti-type元素捕获一个Java异常类型。</p>
<h4 id="欢迎页面"><a href="#欢迎页面" class="headerlink" title="欢迎页面"></a>欢迎页面</h4><p>用户在浏览器中输入的url并不包括某个servlet的映射路径，或者某个具体的静态页面的时候，会根据<code>&lt;welcome-file-list&gt;</code>元素显示默认指定的文件。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></div></pre></td></tr></table></figure>
<p>按列表顺序查找。</p>
<h4 id="MIME类型映射"><a href="#MIME类型映射" class="headerlink" title="MIME类型映射"></a>MIME类型映射</h4><p>MIME(Multipurpose Internet Mail Extensions)多用途互联网邮件扩展类型。<br><code>&lt;mime-mapping&gt;</code>定义扩展文件名映射类型。包括两个元素<code>&lt;extension&gt;</code>和<code>&lt;mime-type&gt;</code>。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/cookie-and-session/" class="prev">PREV</a><a href="/2016/pharmacochemistry-w2/" class="next">NEXT</a></div><div data-thread-key="2016/sevlet-note/" data-title="Servlet学习笔记（一）" data-url="http://leavesite.com/2016/sevlet-note/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"leavesite"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2013 - 2017 <a href="http://leavesite.com">Minfang Lin</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>